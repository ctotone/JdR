<!-- ----------------- -->
<!-- Valeurs integrées -->
<!-- ----------------- -->

<div style="display:none">
    <button type="action" name="act_echec_majeur">
</div>

<!-- --------------------- -->
<!-- Feuille de personnage -->
<!-- --------------------- -->
<div class="feuille">
    <div class="wrapper_feuille">
        <div class="feuille_titre">
            NOTRE TOMBEAU
        </div>
        <div class="feuille_citation">
            "Ceci est le combat du jour et de la nuit...
            <br>
            Je vois de la lumière noire. " <span class="hugo">DERNIERS MOTS DE VICTOR HUGO, 22MAI 1885</span>
        </div>
        <div class="feuille_aptitude">
            <div class="wrapper_aptitude">
                <div class="aptitude_titre1">APTITUDES</div>
                <div class="aptitude_titre2">ACTION</div>
                <div class="aptitude_titre3">NOMBRE DE DÉS À 4 OU +</div>
            </div>
            <div class="wrapper_aptitude" style="margin-top: 15px;">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_courir">COURIR</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_courir" min="1" max="6" value="0"></div>
                <div class="aptitude_3">FACILE</div>
                <div class="aptitude_4">RÉUSSITE AUTOMATIQUE</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_encaisser">ENCAISSER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_encaisser" min="1" max="6" value="0"></div>
                <div class="aptitude_3">RELATIVEMENT FACILE</div>
                <div class="aptitude_4">1</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_escalader">ESCALADER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_escalader" min="1" max="6" value="0"></div>
                <div class="aptitude_3">MOYENNE</div>
                <div class="aptitude_4">2</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_forcer">FORCER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_forcer" min="1" max="6" value="0"></div>
                <div class="aptitude_3">DIFFICILE</div>
                <div class="aptitude_4">3</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_reagir">RÉAGIR</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_reagir" min="1" max="6" value="0"></div>
                <div class="aptitude_3">TRÉS DIFFICILE</div>
                <div class="aptitude_4">4</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_remarquer">REMARQUER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_remarquer" min="1" max="6" value="0"></div>
                <div class="aptitude_3">IMPOSSIBLE</div>
                <div class="aptitude_4">ÉCHEC AUTOMATIQUE</div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_imposer">S'IMPOSER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_imposer" min="1" max="6" value="0"></div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_sauter">SAUTER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_sauter" min="1" max="6" value="0"></div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_savoir_faire">SAVOIR-FAIRE</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_savoir_faire" min="1" max="6" value="0"></div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_se_battre">SE BATTRE</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_se_battre" min="1" max="6" value="0"></div>
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_se_calmer">SE CALMER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_se_calmer" min="1" max="6" value="0"></div>
                
            </div>
            <div class="wrapper_aptitude">
                <div class="aptitude_1"><button type="action" class="aptitudes" name="act_roll_viser">VISER</button></div>
                <div class="aptitude_2"><input type="number" class="aptitudes" name="attr_viser" min="1" max="6" value="0"></div>
            </div>            
        </div>
        <div class="relance"><button type="action" class="aptitudes" name="act_relancer_de">RELANCE <span style="font-size: 13px;margin-left: 3px;">(1 POINT)</span></button> 
        </div>
        <div class="relance_info">relance un dé</div>
        <div class="regain">REGAIN <span style="font-size: 13px;margin-left: 3px;">(1 POINT)</span>
        </div><div class="regain_info">regagne 1 point de Vie</div>
        <div class="feuille_vie">
            <input type="number" class="vie_adrenaline" name="attr_hp" min="1" max="6" value="0">
        </div>
        <div class="feuille_vie_titre">
            VIE
        </div>
        <div class="feuille_adrenaline">
            <input type="number" class="vie_adrenaline" name="attr_adrenaline" min="1" max="6" value="0">
        </div>
        <div class="feuille_adrenaline_titre">
            ADRÉNALINE
        </div>
        <div class="feuille_arme">
            ARMES DE FORTUNE
        </div>
        <div class="feuille_arme_donnees">
            <div class="wrapper_armes" style="margin-top: 15px;">
                <div class="armes_nom"><input type="text" class="armes" name="attr_arme_1"></div>
                <div class="armes_fixe1">(</div>                
                <div class="armes_d1"><input type="number" class="armes_d" name="attr_dgt_arme_1" min="0" max="4" value="0"></div>
                <div class="armes_fixe2">D /</div>
                <div class="armes_d2"><input type="number" class="armes_d" name="attr_dgt_arme_1_relance" min="0" max="2" value="0"></div>
                <div class="armes_fixe3">D)</div>
            </div>
            <div class="wrapper_armes">
                <div class="armes_nom"><input type="text" class="armes" name="attr_arme_2"></div>
                <div class="armes_fixe1">(</div>                
                <div class="armes_d1"><input type="number" class="armes_d" name="attr_dgt_arme_2" min="0" max="4" value="0"></div>
                <div class="armes_fixe2">D /</div>
                <div class="armes_d2"><input type="number" class="armes_d" name="attr_dgt_arme_2_relance" min="0" max="2" value="0"></div>
                <div class="armes_fixe3">D)</div>
            </div>
            <div class="wrapper_armes">
                <div class="armes_nom"><input type="text" class="armes" name="attr_arme_3"></div>
                <div class="armes_fixe1">(</div>                
                <div class="armes_d1"><input type="number" class="armes_d" name="attr_dgt_arme_3" min="0" max="4" value="0"></div>
                <div class="armes_fixe2">D /</div>
                <div class="armes_d2"><input type="number" class="armes_d" name="attr_dgt_arme_3_relance" min="0" max="2" value="0"></div>
                <div class="armes_fixe3">D)</div>
            </div>
            <div class="wrapper_armes">
                <div class="armes_nom"><input type="text" class="armes" name="attr_arme_4"></div>
                <div class="armes_fixe1">(</div>                
                <div class="armes_d1"><input type="number" class="armes_d" name="attr_dgt_arme_4" min="0" max="4" value="0"></div>
                <div class="armes_fixe2">D /</div>
                <div class="armes_d2"><input type="number" class="armes_d" name="attr_dgt_arme_4_relance" min="0" max="2" value="0"></div>
                <div class="armes_fixe3">D)</div>
            </div>
        </div>
        <div class="feuille_sauvagerie">
            SAUVAGERIE
        </div>
        <div class="feuille_sauvagerie_donnees">
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">CARNAGE (2 POINTS)</div>
                <div class="sauvagerie_info">inflige les dommages maximum.</div> 
            </div>
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">FRÉNÉSIE (2 POINTS)</div>
                <div class="sauvagerie_info">deux actions consécutives sans contre.</div> 
            </div>
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">INSENSIBILITÉ (3 POINTS)</div>
                <div class="sauvagerie_info">ignore la dernière perte de points de Vie.</div> 
            </div>
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">FURIE (3 POINTS)</div>
                <div class="sauvagerie_info">deux dés supplémentaires à la prochaine action</div> 
            </div>
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">MISE À MORT (4 POINTS)</div>
                <div class="sauvagerie_info">tue du premier coup ou met KO.</div> 
            </div>
            <div class="wrapper_sauvagerie">
                <div class="sauvagerie_nom">INVULNÉRABILITÉ (X PONTS)</div>
                <div class="sauvagerie_info">regagne autant de Vie que de points d'Adrénaline dépensés.</div> 
            </div>
        </div>
    </div>
</div>

<!-- -------------------- -->
<!-- ----- SCRIPT ------- -->
<!-- -------------------- -->

<!-- Script Roll aptitudes -->
<script type="text/worker">
    on('clicked:roll_courir', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=COURIR}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{courir}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_encaisser', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=ENCAISSER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{encaisser}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_escalader', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=ESCALADER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{escalader}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    
    
    on('clicked:roll_forcer', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=FORCER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{forcer}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_reagir', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=RÉAGIR}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{reagir}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_remarquer', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=REMARQUER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{remarquer}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_imposer', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=IMPOSER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{imposer}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_sauter', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=SAUTER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{sauter}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_savoir_faire', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=SAVOIR-FAIRE}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{savoir_faire}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_se_battre', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=SE BATTRE}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{se_battre}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_se_calmer', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=SE CALMER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{se_calmer}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
    
    on('clicked:roll_viser', (info) => {
        startRoll("&{template:tombeau} {{aptitude=oui}} {{title=VISER}} {{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{viser}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
</script>

<!-- Script Roll se calmer suite à échec majeur -->
<script type="text/worker">
    on('clicked:echec_majeur', (info) => {
        startRoll("&{template:tombeau} {{echec=oui}} {{title=SE CALMER}}{{d1=[[d6]]}} {{d2=[[d6]]}} {{d3=[[d6]]}} {{d4=[[d6]]}} {{d5=[[d6]]}} {{d6=[[d6]]}} {{d1bis=[[d6 (Relance du D1)]]}} {{d2bis=[[d6 (Relance du D2)]]}} {{d3bis=[[d6 (Relance du D3)]]}} {{d4bis=[[d6 (Relance du D4)]]}} {{d5bis=[[d6 (Relance du D5)]]}} {{d6bis=[[d6 (Relance du D6)]]}} {{nombre_de=[[@{se_calmer}]]}} {{difficulte=[[?{Difficulté de l'action|2} -1]]}} {{difficulte_reel=[[?{Difficulté de l'action|2}]]}} {{reussite=[[0[resultat]]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d2 = parseInt(results.results.d2.dice);
            let d3 = parseInt(results.results.d3.dice);
            let d4 = parseInt(results.results.d4.dice);
            let d5 = parseInt(results.results.d5.dice);
            let d6 = parseInt(results.results.d6.dice);
            let difficulte = parseInt(results.results.difficulte.result);
            let nombre_de = parseInt(results.results.nombre_de.result);
            let reussite_1 = 0;
            let reussite_2 = 0;
            let reussite_3 = 0;
            let reussite_4 = 0;
            let reussite_5 = 0;
            let reussite_6 = 0;
            let computed_d1 = 0;
            let computed_d2 = 0;
            let computed_d3 = 0;
            let computed_d4 = 0;
            let computed_d5 = 0;
            let computed_d6 = 0;
            let d1bis = parseInt(results.results.d1bis.dice);
            let d2bis = parseInt(results.results.d2bis.dice);
            let d3bis = parseInt(results.results.d3bis.dice);
            let d4bis = parseInt(results.results.d4bis.dice);
            let d5bis = parseInt(results.results.d5bis.dice);
            let d6bis = parseInt(results.results.d6bis.dice);
            let computed_d1bis = 0;
            let computed_d2bis = 0;
            let computed_d3bis = 0;
            let computed_d4bis = 0;
            let computed_d5bis = 0;
            let computed_d6bis = 0;
            let reussite_1bis = 0;
            let reussite_2bis = 0;
            let reussite_3bis = 0;
            let reussite_4bis = 0;
            let reussite_5bis = 0;
            let reussite_6bis = 0;
            let computed_relance = 0;
            let relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                if (d2 > 3 && nombre_de >= 2) reussite_2 = 1, computed_d2 = d2;
                if (d3 > 3 && nombre_de >= 3) reussite_3 = 1, computed_d3 = d3;
                if (d4 > 3 && nombre_de >= 4) reussite_4 = 1, computed_d4 = d4;
                if (d5 > 3 && nombre_de >= 5) reussite_5 = 1, computed_d5 = d5;
                if (d6 > 3 && nombre_de >= 6) reussite_6 = 1, computed_d6 = d6; 

                
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                if (d1 > 5 && computed_d1bis > 3) reussite_1bis = 1;
                if (d2 > 5 && nombre_de >= 2) computed_d2bis = d2bis, computed_relance = 1;
                if (d2 > 5 && computed_d2bis > 3 && nombre_de >= 2) reussite_2bis = 1;
                if (d3 > 5 && nombre_de >= 3) computed_d3bis = d3bis, computed_relance = 1;
                if (d4 > 5 && computed_d3bis > 3 && nombre_de >= 3) reussite_3bis = 1;
                if (d4 > 5 && nombre_de >= 4) computed_d4bis = d4bis, computed_relance = 1;
                if (d4 > 5 && computed_d4bis > 3 && nombre_de >= 4) reussite_4bis = 1;
                if (d5 > 5 && nombre_de >= 5) computed_d5bis = d5bis, computed_relance = 1;
                if (d5 > 5 && computed_d5bis > 3 && nombre_de >= 5) reussite_5bis = 1;
                if (d6 > 5 && nombre_de >= 6) computed_d6bis = d6bis, computed_relance = 1;
                if (d6 > 5 && computed_d6bis > 3 && nombre_de >= 6) reussite_6bis = 1;

            let reussite_totale = reussite_1 + reussite_2 + reussite_3 + reussite_4 + reussite_5 + reussite_6 + reussite_1bis + reussite_2bis + reussite_3bis + reussite_4bis + reussite_5bis + reussite_6bis;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d2: computed_d2,
                        d3: computed_d3,
                        d4: computed_d4,
                        d5: computed_d5,
                        d6: computed_d6,
                        d1bis: computed_d1bis,
                        d2bis: computed_d2bis,
                        d3bis: computed_d3bis,
                        d4bis: computed_d4bis,
                        d5bis: computed_d5bis,
                        d6bis: computed_d6bis,
                        reussite: reussite_totale,
                        relance: computed_relance
                    }
             );
        });
    });
</script>

<!-- Script Relance d'un dés -->
<script type="text/worker">
    on('clicked:relancer_de', (info) => {
        startRoll("&{template:relance} {{relancer=oui}} {{title=RELANCE}} {{d1=[[d6]]}} {{d1bis=[[d6 (Relance du dé)]]}} {{relance=[[0[resultat]]]}}", (results) => {
                 
            let d1 = parseInt(results.results.d1.dice);
            let d1bis = parseInt(results.results.d1bis.dice);
            let computed_d1bis = 0;
            let computed_relance = 0;
    
                if (d1 > 3) reussite_1 = 1, computed_d1 = d1;
                else reussite_1 = 0, computed_d1 = d1;
                if (d1 > 5) computed_d1bis = d1bis, computed_relance = 1;
                else computed_d1bis = d1bis, computed_relance = 0;

                finishRoll(
                    results.rollId,
                    {
                        d1: computed_d1,
                        d1bis: computed_d1bis,
                        relance: computed_relance

                    }
             );
        });
    });
</script>

<!-- --------------------------- -->
<!-- ----- ROLL TEMPLATE ------- -->
<!-- --------------------------- -->

<rolltemplate class="sheet-rolltemplate-tombeau">
    <div class="ecart"></div>
        <div class="sheet-container">
            <div class="sheet-content">
                    {{#rollTotal() difficulte 0}}
                <div class="sheet-survivant-titre" title="Action relativement facile (1)">{{title}}</div>
                    {{/rollTotal() difficulte 0}}
                    {{#rollTotal() difficulte 1}}
                <div class="sheet-survivant-titre" title="Action moyenne (2)">{{title}}</div>
                    {{/rollTotal() difficulte 1}}
                    {{#rollTotal() difficulte 2}}
                <div class="sheet-survivant-titre" title="Action difficile (3)">{{title}}</div>
                    {{/rollTotal() difficulte 2}}
                    {{#rollTotal() difficulte 3}}
                <div class="sheet-survivant-titre" title="Action très difficile (4)">{{title}}</div>
                    {{/rollTotal() difficulte 3}}
                
                <div class="sheet-resultat-des">
                    {{#rollGreater() nombre_de 0}}
                        {{#rollGreater() computed::d1 3}}
                        <div class="sheet-value-reussite">{{d1}}</div>
                        {{/rollGreater() computed::d1 3}}
                        {{#^rollGreater() computed::d1 3}}
                        <div class="sheet-value-echec">{{d1}}</div>
                        {{/^rollGreater() computed::d1 3}}
                    {{/rollGreater() nombre_de 0}}
                    {{#rollGreater() nombre_de 1}}
                        {{#rollGreater() computed::d2 3}}
                        <div class="sheet-value-reussite">{{d2}}</div>
                        {{/rollGreater() computed::d2 3}}
                        {{#^rollGreater() computed::d2 3}}
                        <div class="sheet-value-echec">{{d2}}</div>
                        {{/^rollGreater() computed::d2 3}}
                    {{/rollGreater() nombre_de 1}}
                    {{#rollGreater() nombre_de 2}}
                        {{#rollGreater() computed::d3 3}}
                        <div class="sheet-value-reussite">{{d3}}</div>
                        {{/rollGreater() computed::d3 3}}
                        {{#^rollGreater() computed::d3 3}}
                        <div class="sheet-value-echec">{{d3}}</div>
                        {{/^rollGreater() computed::d3 3}}
                    {{/rollGreater() nombre_de 2}}
                    {{#rollGreater() nombre_de 3}}
                        {{#rollGreater() computed::d4 3}}
                        <div class="sheet-value-reussite">{{d4}}</div>
                        {{/rollGreater() computed::d4 3}}
                        {{#^rollGreater() computed::d4 3}}
                        <div class="sheet-value-echec">{{d4}}</div>
                        {{/^rollGreater() computed::d4 3}}
                    {{/rollGreater() nombre_de 3}}
                    {{#rollGreater() nombre_de 4}}
                        {{#rollGreater() computed::d5 3}}
                        <div class="sheet-value-reussite">{{d5}}</div>
                        {{/rollGreater() computed::d5 3}}
                        {{#^rollGreater() computed::d5 3}}
                        <div class="sheet-value-echec">{{d5}}</div>
                        {{/^rollGreater() computed::d5 3}}
                    {{/rollGreater() nombre_de 4}}
                    {{#rollGreater() nombre_de 5}}
                        {{#rollGreater() computed::d6 3}}
                        <div class="sheet-value-reussite">{{d6}}</div>
                        {{/rollGreater() computed::d6 3}}
                        {{#^rollGreater() computed::d6 3}}
                        <div class="sheet-value-echec">{{d6}}</div>
                        {{/^rollGreater() computed::d6 3}}
                    {{/rollGreater() nombre_de 5}}
                    <!-- Dés bonus -->
                    {{#rollTotal() computed::relance 1}}
                    <div class="sheet-separateur">/</div>
                    {{/rollTotal() computed::relance 1}}
                    {{#rollGreater() computed::d1 5}}
                        {{#rollGreater() computed::d1bis 3}}
                        <div class="sheet-value-reussite">{{d1bis}}</div>
                        {{/rollGreater() computed::d1bis 3}}
                        {{#^rollGreater() computed::d1bis 3}}
                        <div class="sheet-value-echec">{{d1bis}}</div>
                        {{/^rollGreater() computed::d1bis 3}}
                    {{/rollGreater() computed::d1 5}}
                    {{#rollGreater() computed::d2 5}}
                        {{#rollGreater() computed::d2bis 3}}
                        <div class="sheet-value-reussite">{{d2bis}}</div>
                        {{/rollGreater() computed::d2bis 3}}
                        {{#^rollGreater() computed::d2bis 3}}
                        <div class="sheet-value-echec">{{d2bis}}</div>
                        {{/^rollGreater() computed::d2bis 3}}
                    {{/rollGreater() computed::d2 5}}
                    {{#rollGreater() computed::d3 5}}
                        {{#rollGreater() computed::d3bis 3}}
                        <div class="sheet-value-reussite">{{d3bis}}</div>
                        {{/rollGreater() computed::d3bis 3}}
                        {{#^rollGreater() computed::d3bis 3}}
                        <div class="sheet-value-echec">{{d3bis}}</div>
                        {{/^rollGreater() computed::d3bis 3}}
                    {{/rollGreater() computed::d3 5}}
                    {{#rollGreater() computed::d4 5}}
                        {{#rollGreater() computed::d4bis 3}}
                        <div class="sheet-value-reussite">{{d4bis}}</div>
                        {{/rollGreater() computed::d4bis 3}}
                        {{#^rollGreater() computed::d4bis 3}}
                        <div class="sheet-value-echec">{{d4bis}}</div>
                        {{/^rollGreater() computed::d4bis 3}}
                    {{/rollGreater() computed::d4 5}}
                    {{#rollGreater() computed::d5 5}}
                        {{#rollGreater() computed::d5bis 3}}
                        <div class="sheet-value-reussite">{{d5bis}}</div>
                        {{/rollGreater() computed::d5bis 3}}
                        {{#^rollGreater() computed::d5bis 3}}
                        <div class="sheet-value-echec">{{d5bis}}</div>
                        {{/^rollGreater() computed::d5bis 3}}
                    {{/rollGreater() computed::d5 5}}
                    {{#rollGreater() computed::d6 5}}
                        {{#rollGreater() computed::d6bis 3}}
                        <div class="sheet-value-reussite">{{d6bis}}</div>
                        {{/rollGreater() computed::d6bis 3}}
                        {{#^rollGreater() computed::d6bis 3}}
                        <div class="sheet-value-echec">{{d6bis}}</div>
                        {{/^rollGreater() computed::d6bis 3}}
                    {{/rollGreater() computed::d6 5}}
                </div>
                {{#aptitude}}
                    {{#rollTotal() difficulte 0}}
                        {{#^rollLess() computed::reussite difficulte_reel}}
                            <div class="sheet-desc-reussite1">RÉUSSITE</div>
                        {{/^rollLess() computed::reussite difficulte_reel}}
                        {{#rollLess() computed::reussite difficulte_reel}}
                            <div class="sheet-desc-echec1">ÉCHEC</div>
                        {{/rollLess() computed::reussite difficulte_reel}}
                    {{/rollTotal() difficulte 0}}
                    {{#^rollTotal() difficulte 0}}
                        {{#^rollLess() computed::reussite difficulte_reel}}
                            {{#rollGreater() computed::reussite difficulte_reel}}
                                <div class="sheet-desc-reussite1">RÉUSSITE MAJEURE</div>
                                <div class="sheet-desc-adrenaline_gain">Vous gagnez 1 point d'Adrénaline</div>
                            {{/rollGreater() computed::reussite difficulte_reel}}
                            {{#^rollGreater() computed::reussite difficulte_reel}}
                                <div class="sheet-desc-reussite2">RÉUSSITE</div>
                            {{/^rollGreater() computed::reussite difficulte_reel}}
                        {{/^rollLess() computed::reussite difficulte_reel}}
                        {{#rollLess() computed::reussite difficulte_reel}}
                            {{#rollGreater() computed::reussite 0}}  
                            <div class="sheet-desc-echec2">ÉCHEC</div>
                            {{/rollGreater() computed::reussite 0}}
                            {{#^rollGreater() computed::reussite 0}}  
                            <div class="sheet-desc-echec1">ÉCHEC MAJEUR</div>
                            <div class="sheet-desc-adrenaline_perte">[Vous perdez 1 point d'Adrénaline mais vous pouvez tentez-de vous calmer...](~selected|echec_majeur)</div>
                            {{/^rollGreater() computed::reussite 0}}    
                        {{/rollLess() computed::reussite difficulte_reel}}
                    {{/^rollTotal() difficulte 0}}
                {{/aptitude}}
                {{#echec}}
                    {{#^rollLess() computed::reussite difficulte_reel}}
                        <div class="sheet-desc-reussite1">RÉUSSITE</div><br>
                        <div class="sheet-desc-adrenaline_gain">Vous ne perdez aucun point d'Adrénaline</div>
                    {{/^rollLess() computed::reussite difficulte_reel}}
                    {{#rollLess() computed::reussite difficulte_reel}}
                        <div class="sheet-desc-echec1">ÉCHEC</div>
                        <div class="sheet-desc-adrenaline_perte">Vous perdez, non pas 1, mais 2 points d'Adrénaline</div>
                    {{/rollLess() computed::reussite difficulte_reel}}
                {{/echec}}
            </div>
        </div>
</rolltemplate>



<rolltemplate class="sheet-rolltemplate-relance">
    <div class="ecart"></div>
        <div class="sheet-container">
            <div class="sheet-content">
                {{#relancer}}
                <div class="sheet-survivant-titre">{{title}}</div>
                <div class="sheet-resultat-des"> 
                    {{#rollGreater() computed::d1 3}}
                            <div class="sheet-value-reussite">{{computed::d1}}</div>
                    {{/rollGreater() computed::d1 3}}
                    {{#^rollGreater() computed::d1 3}}
                            <div class="sheet-value-echec">{{computed::d1}}</div>
                    {{/^rollGreater() computed::d1 3}}
                    

                    {{#rollTotal() computed::relance 1}}
                            <div class="sheet-separateur">/</div>
                        {{#rollGreater() computed::d1bis 3}}
                            <div class="sheet-value-reussite">{{d1bis}}</div>
                        {{/rollGreater() computed::d1bis 3}}
                        {{#^rollGreater() computed::d1bis 3}}
                            <div class="sheet-value-echec">{{d1bis}}</div>
                        {{/^rollGreater() computed::d1bis 3}}
                    {{/rollTotal() computed::relance 1}}
                </div>
                {{/relancer}}
            </div>
        </div>
</rolltemplate>




