<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>G√©n√©rateur de Galerie Souterraine - Narration Immersive</title>
  <style>
    body { font-family: Georgia, serif; background-color: #111; color: #eee; padding: 20px; }
    .container { max-width: 800px; margin: auto; background-color: #1e1e1e; padding: 30px; border-radius: 12px; }
    button { padding: 12px 25px; font-size: 16px; background-color: #333; color: #fff; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 25px; }
    .result { background-color: #2a2a2a; padding: 20px; border-radius: 8px; line-height: 1.6; font-size: 17px; }
    .result p { margin-bottom: 1em; }
    .loot { margin-top: 15px; padding-top: 10px; border-top: 1px solid #555; font-style: italic; color: #bbb; }
    .intersection { margin-top: 20px; padding-top: 10px; border-top: 1px dashed #777; font-weight: bold; color: #aaf; }
    .narration p { margin-bottom: 1em; }
    .extras { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>G√©n√©rateur de Galerie Souterraine</h1>
    <button id="generate-btn">G√©n√©rer un passage</button>
    <div class="result" id="resultat"></div>
  </div>

  <script>
    const directions = [
      "Alors que vous avancez dans le silence oppressant,",
      "Votre progression vous m√®ne inexorablement √† travers ces couloirs,",
      "En poursuivant votre route,",
      "√Ä mesure que vous vous enfoncez davantage,",
      "Vos pas vous guident dans cette obscurit√© inconnue,",
      "Sans pr√©venir, le couloir se resserre,",
      "Un frisson parcourt vos os alors que vous avancez,",
      "L'air se fait plus lourd tandis que vous progressez,",
      "Le silence s'alourdit √† mesure que vous avancez,",
      "Une vibration sourde se propage sous vos pas,"
    ];

    const environnement = [
      "Vous remarquez que l‚Äôenvironnement imm√©diat est particulier.",
      "L‚Äôatmosph√®re change subtilement autour de vous.",
      "Le lieu semble porter les marques du temps.",
      "L‚Äô√©tat des lieux laisse penser √† un long abandon.",
      "Le d√©cor qui vous entoure est frappant.",
      "L'air semble charg√© d'une √©nergie indescriptible.",
      "Les murs vibrent l√©g√®rement sous l'humidit√©.",
      "Les t√©n√®bres paraissent presque vivantes.",
      "Une odeur de pierre br√ªl√©e flotte discr√®tement.",
      "Des lueurs phosphorescentes naissent dans l'obscurit√©."
    ];

    const sensesData = {
      vue: [
        "des ombres dansent au rythme de votre lampe",
        "une silhouette fig√©e surgit dans le halo de lumi√®re",
        "une vieille porte m√©tallique appara√Æt au d√©tour du mur",
        "la lumi√®re r√©v√®le un graffiti presque effac√©",
        "des symboles grav√©s attirent furtivement votre attention",
        "des reflets bougent √† la surface d‚Äôune flaque",
        "le d√©cor semble fig√© dans une √©ternit√© min√©rale",
        "un reflet m√©tallique attire l‚Äô≈ìil dans un recoin",
        "des formes g√©om√©triques sont sculpt√©es dans la paroi",
        "la poussi√®re flotte lentement dans l‚Äôair",
        "le d√©cor devient plus oppressant √† chaque pas",
        "un puits vertical s‚Äôouvre soudain sous vos pieds",
        "des marches apparaissent sur un c√¥t√©",
        "le tunnel se r√©tr√©cit brutalement",
        "un recoin para√Æt r√©cemment am√©nag√©",
        "un squelette animal en d√©composition jonche le sol",
        "des racines lumineuses traversent la roche",
        "un mur peint semble signaler un passage oubli√©",
        "un reflet d'eau vibre dans l'obscurit√©",
        "un pan de roche effondr√© bloque une moiti√© du passage"
      ],
      odeur: [
        "l‚Äôodeur √¢cre du soufre s‚Äôimpose",
        "une senteur de rouille humide vous prend √† la gorge",
        "l‚Äôair est satur√© d‚Äôun relent de moisissure",
        "un parfum m√©tallique flotte dans l‚Äôatmosph√®re",
        "une senteur de torchis d√©tremp√© vous enveloppe",
        "l‚Äôair vibre d‚Äôune humidit√© putride",
        "une fragrance de terre souill√©e persiste",
        "un relent de vieux cuir mouill√© tra√Æne dans l‚Äôair",
        "l‚Äôodeur de d√©composition est presque imperceptible",
        "vous respirez une effluve d‚Äô√©gout antique",
        "une vague odeur de cendres froides subsiste",
        "un parfum rance sature le passage",
        "un filet d‚Äôair transporte une senteur de viande avari√©e",
        "l‚Äôair a un go√ªt de pierre fendue",
        "une odeur de moisissure ancienne stagne sous la vo√ªte",
        "des relents acides montent du sol",
        "un parfum d‚Äôalgues pourries s‚Äô√©l√®ve dans l‚Äôair",
        "une odeur de plastique br√ªl√© flotte autour",
        "un effluve humide de roche lessiv√©e est perceptible",
        "une senteur d‚Äôargile humide se fait sentir"
      ],
      ouie: [
        "un bourdonnement lointain trouble le silence",
        "des gouttes tombent √† intervalles r√©guliers",
        "le murmure du vent glisse √† travers une fissure",
        "un cliquetis m√©tallique r√©sonne au loin",
        "le gr√©sillement d‚Äôun n√©on d√©faillant vous accompagne",
        "un √©cho incertain rebondit contre les parois",
        "le frottement de votre sac para√Æt assourdissant",
        "le silence est seulement troubl√© par vos propres pas",
        "un gargouillement d‚Äôeau sale se fait entendre",
        "vous entendez un chuintement inexplicable",
        "le grincement d‚Äôune structure lointaine rompt l‚Äôambiance",
        "un clapotement intermittent provient d‚Äôun puits lat√©ral",
        "des craquements secs ponctuent votre progression",
        "un bruit √©touff√© √©voque quelque chose qui glisse",
        "un soupir invisible semble traverser les murs",
        "des bruissements d‚Äôailes se font entendre bri√®vement",
        "un grattement intermittent provient du plafond",
        "un bourdonnement de moustiques s‚Äôintensifie",
        "le craquement lointain d‚Äôune roche instable vous alerte",
        "un ruissellement sonore vous suit comme une pr√©sence"
      ],
      toucher: [
        "la roche est froide et l√©g√®rement visqueuse",
        "le m√©tal rouill√© accroche vos doigts",
        "le sol vibre subtilement sous vos pas",
        "le mur semble respirer faiblement",
        "la poussi√®re colle √† votre peau",
        "une humidit√© stagnante impr√®gne chaque surface",
        "le plafond laisse couler quelques gouttes glac√©es",
        "une paroi semble creuse sous vos doigts",
        "le sol crisse sous vos chaussures",
        "un frisson traverse votre main sans raison apparente",
        "la pierre suinte au toucher",
        "des fissures parcourent les parois comme des veines",
        "une vibration infime parcourt le mur",
        "le sol para√Æt remuer sous une fine couche de sable",
        "le contact du sol provoque une √©trange sensation d‚Äôenfoncement",
        "une rugosit√© agressive vous √©rafle les doigts",
        "la paroi est ti√®de, comme si elle conservait la chaleur",
        "vos mains rencontrent une surface molle et humide",
        "la mati√®re devient crayeuse et s‚Äôeffrite au toucher",
        "des asp√©rit√©s tranchantes forcent la prudence"
      ],
      gout: [
        "vous avez la bouche p√¢teuse sans comprendre pourquoi",
        "un go√ªt m√©tallique remplit votre gorge",
        "votre salive a une saveur √¢cre et d√©sagr√©able",
        "vous ressentez une sensation de s√©cheresse soudaine",
        "une amertume √©trange vous envahit la langue",
        "le go√ªt de pierre humide vous reste sur le palais",
        "une saveur ferrugineuse semble provenir de l‚Äôair",
        "votre gorge se serre sous un go√ªt poussi√©reux",
        "une trace am√®re remonte depuis votre estomac",
        "un go√ªt de moisi persiste sur votre langue",
        "vous ressentez comme une pointe de sang s√©ch√©",
        "un arri√®re-go√ªt de cendre vous prend par surprise",
        "une saveur terreuse remplit votre bouche",
        "une sensation m√©tallique vous fait saliver",
        "un go√ªt d‚Äôhuile rance vous monte au nez",
        "un r√©sidu min√©ral ass√®che votre palais",
        "une saveur de cuivre flotte en bouche",
        "le go√ªt d‚Äôhumidit√© stagnante vous agace les dents",
        "vos l√®vres br√ªlent d‚Äôune acidit√© latente",
        "un go√ªt salin inattendu vous surprend"
      ]
    };

    const loot = [
      "une bo√Æte d‚Äôallumettes prot√©g√©e dans un sachet plastique",
      "un briquet presque vide",
      "un morceau de corde effiloch√©",
      "une vieille gourde contenant encore un peu d‚Äôeau",
      "une lampe dynamo fonctionnelle",
      "un couteau de poche rouill√© mais utilisable",
      "un kit de pansement improvis√©",
      "un paquet de biscuits entam√©",
      "un crayon gras et un carnet d√©tremp√©",
      "une barre √©nerg√©tique intacte",
      "une radio √† piles muette",
      "un masque poussi√©reux",
      "un tube de colle forte",
      "une bo√Æte m√©tallique contenant un sifflet",
      "un flacon d‚Äôalcool antiseptique √† moiti√© plein",
      "des piles de rechange emball√©es",
      "un miroir de signalisation ray√©",
      "une couverture de survie pli√©e",
      "une vieille carte partielle des √©gouts",
      "un tournevis multifonction",
      "un briquet temp√™te flambant neuf",
      "une boussole magn√©tique l√©g√®rement d√©r√©gl√©e",
      "un flacon de poison v√©t√©rinaire (usage douteux)",
      "une mini-lanterne √† LED rechargeable",
      "un crochet pour grimper accrocheur",
      "un rouleau de scotch renforc√©",
      "une gourde filtrante derni√®re g√©n√©ration",
      "une petite trousse de chantier (vis, √©crous, boulons)",
      "un kit de survie en bo√Æte m√©tallique",
      "un sifflet d‚Äôurgence ultrasonique",
      "une paire de gants en kevlar",
      "une montre-bracelet sans piles",
      "un kit dentaire de fortune",
      "un spray anti-insectes quasi vide",
      "un sachet de graines fluorescentes",
      "un miroir bris√© (pour signaux)"
    ];

    const intersections = [
      "Une fourche en T : √† gauche, un couloir √©troit ; √† droite, un escalier partiellement effondr√©.",
      "Un croisement en √©toile √† trois embranchements indistincts.",
      "Un carrefour marqu√© d‚Äôinscriptions effac√©es dans chaque direction.",
      "Une bifurcation o√π un conduit lat√©ral monte vers l‚Äôobscurit√©.",
      "Un embranchement en L, l‚Äôun des chemins semble plus silencieux.",
      "Une jonction en Y : deux tunnels se rejoignent vers le nord.",
      "Un passage oblique et un escalier descendant apparaissent.",
      "Un croisement cach√© par des d√©bris, difficile √† distinguer.",
      "Une intersection circulaire avec un puits vertical central.",
      "Une bifurcation, un symbole grav√© indique la droite.",
      "Un embranchement aquatique : un tunnel inond√© vers l‚Äôest, un passage sec vers l‚Äôouest.",
      "Une jonction √† quatre voies, chacune signal√©e par une torche √©teinte.",
      "Un corridor principal diverge en deux galeries de taille in√©gale.",
      "Un virage serr√© m√®ne √† deux conduits parall√®les s√©par√©s par une faille.",
      "Un carrefour o√π un escalier en colima√ßon monte vers l‚Äôobscurit√©.",
      "Une intersection partiellement effondr√©e offrant un seul passage praticable.",
      "Un Y invers√© : le bras central plonge dans un gouffre.",
      "Un embranchement mural cach√© derri√®re une paroi mobile dissimul√©e.",
      "Une crois√©e de couloirs avec une dalle grav√©e en son centre.",
      "Une fourche √† trois voies avec des √©tendues d‚Äôeau stagnante."
    ];

    const transitions = {
      directions: [
        "Alors que vous avancez dans le silence oppressant,",
        "Votre progression vous m√®ne inexorablement √† travers ces couloirs,",
        "En poursuivant votre route,",
        "√Ä mesure que vous vous enfoncez davantage,",
        "Vos pas vous guident dans cette obscurit√© inconnue,",
        "Sans pr√©venir, le couloir se resserre,",
        "Un frisson parcourt vos os alors que vous avancez,",
        "L'air se fait plus lourd tandis que vous progressez,",
        "Le silence s'alourdit √† mesure que vous avancez,",
        "Une vibration sourde se propage sous vos pas,"
      ],
      environnement: [
        "Vous remarquez que l‚Äôenvironnement imm√©diat est particulier.",
        "L‚Äôatmosph√®re change subtilement autour de vous.",
        "Le lieu semble porter les marques du temps.",
        "L‚Äô√©tat des lieux laisse penser √† un long abandon.",
        "Le d√©cor qui vous entoure est frappant.",
        "L'air semble charg√© d'une √©nergie indescriptible.",
        "Les murs vibrent l√©g√®rement sous l'humidit√©.",
        "Les t√©n√®bres paraissent presque vivantes.",
        "Une odeur de pierre br√ªl√©e flotte discr√®tement.",
        "Des lueurs phosphorescentes naissent dans l'obscurit√©."
      ],
      vue: [
        "√Ä la lueur de votre lampe,",
        "Dans le faible √©clairage,",
        "Vos yeux s‚Äôhabituent peu √† peu √† l‚Äôobscurit√©,",
        "Autour de vous,",
        "En scrutant les alentours,",
        "√Ä travers la p√©nombre,",
        "Votre lumi√®re vacille en r√©v√©lant,",
        "Dans l'ombre mouvante,",
        "Votre regard capte,",
        "Une silhouette fugace appara√Æt,"
      ],
      odeur: [
        "L‚Äôodeur ambiante vous prend soudain √† la gorge.",
        "Un parfum inattendu vous heurte les narines.",
        "Vous √™tes saisi par une √©manation particuli√®re.",
        "L‚Äôair est satur√© d‚Äôune senteur √©trange.",
        "Votre nez capte une effluve marquante.",
        "Un ar√¥me de champignons pourris vous chatouille,",
        "Une effluve de sel marin envahit,",
        "Une odeur de soufre ancien s'√©l√®ve,",
        "Un parfum de champs d'herbes folles perce,",
        "Un relent de poussi√®re cimenteuse plane,"
      ],
      ouie: [
        "Un son singulier vous parvient √† l‚Äôoreille.",
        "Vous percevez un bruit difficile √† localiser.",
        "Un √©cho discret se r√©percute contre les murs.",
        "Le silence est trahi par un son inattendu.",
        "Une ambiance sonore se fait sentir dans le lointain.",
        "Un g√©missement sourd perce le silence,",
        "Un murmure aigu semble vous appeler,",
        "Un tic-tac r√©gulier r√©sonne en √©cho,",
        "Un cliquetis lointain √©voque un m√©canisme,",
        "Une plainte lointaine se fait entendre,"
      ],
      toucher: [
        "En fr√¥lant une paroi,",
        "Votre main effleure quelque chose d‚Äôinhabituel.",
        "Vous sentez sous vos doigts une texture particuli√®re.",
        "Votre contact avec les lieux vous renseigne davantage.",
        "En glissant votre paume sur les murs,",
        "La surface para√Æt vibrer sous votre paume,",
        "Votre peau per√ßoit un l√©ger picotement,",
        "Le sol semble pulser l√©g√®rement,",
        "Une fra√Æcheur soudaine glace vos doigts,",
        "Un courant d'air glacial fr√¥le votre cuir,"
      ],
      gout: [
        "Une √©trange saveur s‚Äôimpose √† votre bouche.",
        "Un arri√®re-go√ªt persistant vous surprend.",
        "Votre palais est troubl√© par une sensation √©trange.",
        "Un go√ªt involontaire envahit votre bouche.",
        "Vous percevez en inspirant une saveur inattendue.",
        "Un arri√®re-go√ªt de fer br√ªl√© persiste,",
        "Votre langue per√ßoit une saveur sucr√©e √©trange,",
        "Une pointe d'acidit√© pique votre palais,",
        "Un go√ªt de sel ancien envahit votre bouche,",
        "Une note m√©tallique intense r√©sonne,"
      ]
    };

    function choix(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function genererGalerie() {
      const narration = [];
      narration.push(`<p>${choix(transitions.directions)} ${choix(directions)}</p>`);
      narration.push(`<p>${choix(transitions.environnement)} ${choix(environnement)}</p>`);
      const senses = Object.keys(sensesData);
      senses.sort(() => Math.random() - 0.5).slice(0,3).forEach(sens => {
        narration.push(`<p>${choix(transitions[sens])} ${choix(sensesData[sens])}</p>`);
      });
      const lootHtml = `<div class="loot">üéí Vous trouvez : <strong>${choix(loot)}</strong></div>`;
      const intersectionHtml = `<div class="intersection">üîÄ Intersection : ${choix(intersections)}</div>`;
      return `<div class="narration">${narration.join('')}</div><div class="extras">${lootHtml}${intersectionHtml}</div>`;
    }
    async function ameliorerTexteAvecIA(html) {
      try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST', headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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'
          }, body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              { role: 'system', content: "Retravaille ce HTML pour am√©liorer fluidit√© et style dans le contexte de 'Notre tombeau', en conservant les balises <p> et <div class='extras'>." },
              { role: 'user', content: html }
            ], temperature: 0.7
          })
        });
        if (!res.ok) {
          const err = await res.json();
          console.error('API error:', err.error?.message || err);
          return html;
        }
        const data = await res.json();
        return data.choices?.[0]?.message?.content || html;
      } catch (e) {
        console.error('Erreur r√©seau:', e);
        return html;
      }
    }
    async function genererEtAfficher() {
      const rawHtml = genererGalerie();
      document.getElementById('resultat').innerHTML = '<p>Am√©lioration en cours‚Ä¶</p>';
      const improved = await ameliorerTexteAvecIA(rawHtml);
      document.getElementById('resultat').innerHTML = improved;
    }
    document.getElementById('generate-btn').addEventListener('click', genererEtAfficher);
  </script>
</body>
</html>
