<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Générateur de Galerie Souterraine - Narration Immersive</title>
  <style>
    body { font-family: Georgia, serif; background-color: #111; color: #eee; padding: 20px; }
    .container { max-width: 800px; margin: auto; background-color: #1e1e1e; padding: 30px; border-radius: 12px; }
    button { padding: 12px 25px; font-size: 16px; background-color: #333; color: #fff; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 25px; }
    .result { background-color: #2a2a2a; padding: 20px; border-radius: 8px; line-height: 1.6; font-size: 17px; }
    .result p { margin-bottom: 1em; }
    .loot { margin-top: 15px; padding-top: 10px; border-top: 1px solid #555; font-style: italic; color: #bbb; }
    .intersection { margin-top: 20px; padding-top: 10px; border-top: 1px dashed #777; font-weight: bold; color: #aaf; }
    .narration p { margin-bottom: 1em; }
    .extras { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Générateur de Galerie Souterraine</h1>
    <button id="generate-btn">Générer un passage</button>
    <div class="result" id="resultat"></div>
  </div>

  <script>
    const directions = [
      "Alors que vous avancez dans le silence oppressant,",
      "Votre progression vous mène inexorablement à travers ces couloirs,",
      "En poursuivant votre route,",
      "À mesure que vous vous enfoncez davantage,",
      "Vos pas vous guident dans cette obscurité inconnue,",
      "Sans prévenir, le couloir se resserre,",
      "Un frisson parcourt vos os alors que vous avancez,",
      "L'air se fait plus lourd tandis que vous progressez,",
      "Le silence s'alourdit à mesure que vous avancez,",
      "Une vibration sourde se propage sous vos pas,"
    ];

    const environnement = [
      "Vous remarquez que l’environnement immédiat est particulier.",
      "L’atmosphère change subtilement autour de vous.",
      "Le lieu semble porter les marques du temps.",
      "L’état des lieux laisse penser à un long abandon.",
      "Le décor qui vous entoure est frappant.",
      "L'air semble chargé d'une énergie indescriptible.",
      "Les murs vibrent légèrement sous l'humidité.",
      "Les ténèbres paraissent presque vivantes.",
      "Une odeur de pierre brûlée flotte discrètement.",
      "Des lueurs phosphorescentes naissent dans l'obscurité."
    ];

    const sensesData = {
      vue: [
        "des ombres dansent au rythme de votre lampe",
        "une silhouette figée surgit dans le halo de lumière",
        "une vieille porte métallique apparaît au détour du mur",
        "la lumière révèle un graffiti presque effacé",
        "des symboles gravés attirent furtivement votre attention",
        "des reflets bougent à la surface d’une flaque",
        "le décor semble figé dans une éternité minérale",
        "un reflet métallique attire l’œil dans un recoin",
        "des formes géométriques sont sculptées dans la paroi",
        "la poussière flotte lentement dans l’air",
        "le décor devient plus oppressant à chaque pas",
        "un puits vertical s’ouvre soudain sous vos pieds",
        "des marches apparaissent sur un côté",
        "le tunnel se rétrécit brutalement",
        "un recoin paraît récemment aménagé",
        "un squelette animal en décomposition jonche le sol",
        "des racines lumineuses traversent la roche",
        "un mur peint semble signaler un passage oublié",
        "un reflet d'eau vibre dans l'obscurité",
        "un pan de roche effondré bloque une moitié du passage"
      ],
      odeur: [
        "l’odeur âcre du soufre s’impose",
        "une senteur de rouille humide vous prend à la gorge",
        "l’air est saturé d’un relent de moisissure",
        "un parfum métallique flotte dans l’atmosphère",
        "une senteur de torchis détrempé vous enveloppe",
        "l’air vibre d’une humidité putride",
        "une fragrance de terre souillée persiste",
        "un relent de vieux cuir mouillé traîne dans l’air",
        "l’odeur de décomposition est presque imperceptible",
        "vous respirez une effluve d’égout antique",
        "une vague odeur de cendres froides subsiste",
        "un parfum rance sature le passage",
        "un filet d’air transporte une senteur de viande avariée",
        "l’air a un goût de pierre fendue",
        "une odeur de moisissure ancienne stagne sous la voûte",
        "des relents acides montent du sol",
        "un parfum d’algues pourries s’élève dans l’air",
        "une odeur de plastique brûlé flotte autour",
        "un effluve humide de roche lessivée est perceptible",
        "une senteur d’argile humide se fait sentir"
      ],
      ouie: [
        "un bourdonnement lointain trouble le silence",
        "des gouttes tombent à intervalles réguliers",
        "le murmure du vent glisse à travers une fissure",
        "un cliquetis métallique résonne au loin",
        "le grésillement d’un néon défaillant vous accompagne",
        "un écho incertain rebondit contre les parois",
        "le frottement de votre sac paraît assourdissant",
        "le silence est seulement troublé par vos propres pas",
        "un gargouillement d’eau sale se fait entendre",
        "vous entendez un chuintement inexplicable",
        "le grincement d’une structure lointaine rompt l’ambiance",
        "un clapotement intermittent provient d’un puits latéral",
        "des craquements secs ponctuent votre progression",
        "un bruit étouffé évoque quelque chose qui glisse",
        "un soupir invisible semble traverser les murs",
        "des bruissements d’ailes se font entendre brièvement",
        "un grattement intermittent provient du plafond",
        "un bourdonnement de moustiques s’intensifie",
        "le craquement lointain d’une roche instable vous alerte",
        "un ruissellement sonore vous suit comme une présence"
      ],
      toucher: [
        "la roche est froide et légèrement visqueuse",
        "le métal rouillé accroche vos doigts",
        "le sol vibre subtilement sous vos pas",
        "le mur semble respirer faiblement",
        "la poussière colle à votre peau",
        "une humidité stagnante imprègne chaque surface",
        "le plafond laisse couler quelques gouttes glacées",
        "une paroi semble creuse sous vos doigts",
        "le sol crisse sous vos chaussures",
        "un frisson traverse votre main sans raison apparente",
        "la pierre suinte au toucher",
        "des fissures parcourent les parois comme des veines",
        "une vibration infime parcourt le mur",
        "le sol paraît remuer sous une fine couche de sable",
        "le contact du sol provoque une étrange sensation d’enfoncement",
        "une rugosité agressive vous érafle les doigts",
        "la paroi est tiède, comme si elle conservait la chaleur",
        "vos mains rencontrent une surface molle et humide",
        "la matière devient crayeuse et s’effrite au toucher",
        "des aspérités tranchantes forcent la prudence"
      ],
      gout: [
        "vous avez la bouche pâteuse sans comprendre pourquoi",
        "un goût métallique remplit votre gorge",
        "votre salive a une saveur âcre et désagréable",
        "vous ressentez une sensation de sécheresse soudaine",
        "une amertume étrange vous envahit la langue",
        "le goût de pierre humide vous reste sur le palais",
        "une saveur ferrugineuse semble provenir de l’air",
        "votre gorge se serre sous un goût poussiéreux",
        "une trace amère remonte depuis votre estomac",
        "un goût de moisi persiste sur votre langue",
        "vous ressentez comme une pointe de sang séché",
        "un arrière-goût de cendre vous prend par surprise",
        "une saveur terreuse remplit votre bouche",
        "une sensation métallique vous fait saliver",
        "un goût d’huile rance vous monte au nez",
        "un résidu minéral assèche votre palais",
        "une saveur de cuivre flotte en bouche",
        "le goût d’humidité stagnante vous agace les dents",
        "vos lèvres brûlent d’une acidité latente",
        "un goût salin inattendu vous surprend"
      ]
    };

    const loot = [
      "une boîte d’allumettes protégée dans un sachet plastique",
      "un briquet presque vide",
      "un morceau de corde effiloché",
      "une vieille gourde contenant encore un peu d’eau",
      "une lampe dynamo fonctionnelle",
      "un couteau de poche rouillé mais utilisable",
      "un kit de pansement improvisé",
      "un paquet de biscuits entamé",
      "un crayon gras et un carnet détrempé",
      "une barre énergétique intacte",
      "une radio à piles muette",
      "un masque poussiéreux",
      "un tube de colle forte",
      "une boîte métallique contenant un sifflet",
      "un flacon d’alcool antiseptique à moitié plein",
      "des piles de rechange emballées",
      "un miroir de signalisation rayé",
      "une couverture de survie pliée",
      "une vieille carte partielle des égouts",
      "un tournevis multifonction",
      "un briquet tempête flambant neuf",
      "une boussole magnétique légèrement déréglée",
      "un flacon de poison vétérinaire (usage douteux)",
      "une mini-lanterne à LED rechargeable",
      "un crochet pour grimper accrocheur",
      "un rouleau de scotch renforcé",
      "une gourde filtrante dernière génération",
      "une petite trousse de chantier (vis, écrous, boulons)",
      "un kit de survie en boîte métallique",
      "un sifflet d’urgence ultrasonique",
      "une paire de gants en kevlar",
      "une montre-bracelet sans piles",
      "un kit dentaire de fortune",
      "un spray anti-insectes quasi vide",
      "un sachet de graines fluorescentes",
      "un miroir brisé (pour signaux)"
    ];

    const intersections = [
      "Une fourche en T : à gauche, un couloir étroit ; à droite, un escalier partiellement effondré.",
      "Un croisement en étoile à trois embranchements indistincts.",
      "Un carrefour marqué d’inscriptions effacées dans chaque direction.",
      "Une bifurcation où un conduit latéral monte vers l’obscurité.",
      "Un embranchement en L, l’un des chemins semble plus silencieux.",
      "Une jonction en Y : deux tunnels se rejoignent vers le nord.",
      "Un passage oblique et un escalier descendant apparaissent.",
      "Un croisement caché par des débris, difficile à distinguer.",
      "Une intersection circulaire avec un puits vertical central.",
      "Une bifurcation, un symbole gravé indique la droite.",
      "Un embranchement aquatique : un tunnel inondé vers l’est, un passage sec vers l’ouest.",
      "Une jonction à quatre voies, chacune signalée par une torche éteinte.",
      "Un corridor principal diverge en deux galeries de taille inégale.",
      "Un virage serré mène à deux conduits parallèles séparés par une faille.",
      "Un carrefour où un escalier en colimaçon monte vers l’obscurité.",
      "Une intersection partiellement effondrée offrant un seul passage praticable.",
      "Un Y inversé : le bras central plonge dans un gouffre.",
      "Un embranchement mural caché derrière une paroi mobile dissimulée.",
      "Une croisée de couloirs avec une dalle gravée en son centre.",
      "Une fourche à trois voies avec des étendues d’eau stagnante."
    ];

    const transitions = {
      directions: [
        "Alors que vous avancez dans le silence oppressant,",
        "Votre progression vous mène inexorablement à travers ces couloirs,",
        "En poursuivant votre route,",
        "À mesure que vous vous enfoncez davantage,",
        "Vos pas vous guident dans cette obscurité inconnue,",
        "Sans prévenir, le couloir se resserre,",
        "Un frisson parcourt vos os alors que vous avancez,",
        "L'air se fait plus lourd tandis que vous progressez,",
        "Le silence s'alourdit à mesure que vous avancez,",
        "Une vibration sourde se propage sous vos pas,"
      ],
      environnement: [
        "Vous remarquez que l’environnement immédiat est particulier.",
        "L’atmosphère change subtilement autour de vous.",
        "Le lieu semble porter les marques du temps.",
        "L’état des lieux laisse penser à un long abandon.",
        "Le décor qui vous entoure est frappant.",
        "L'air semble chargé d'une énergie indescriptible.",
        "Les murs vibrent légèrement sous l'humidité.",
        "Les ténèbres paraissent presque vivantes.",
        "Une odeur de pierre brûlée flotte discrètement.",
        "Des lueurs phosphorescentes naissent dans l'obscurité."
      ],
      vue: [
        "À la lueur de votre lampe,",
        "Dans le faible éclairage,",
        "Vos yeux s’habituent peu à peu à l’obscurité,",
        "Autour de vous,",
        "En scrutant les alentours,",
        "À travers la pénombre,",
        "Votre lumière vacille en révélant,",
        "Dans l'ombre mouvante,",
        "Votre regard capte,",
        "Une silhouette fugace apparaît,"
      ],
      odeur: [
        "L’odeur ambiante vous prend soudain à la gorge.",
        "Un parfum inattendu vous heurte les narines.",
        "Vous êtes saisi par une émanation particulière.",
        "L’air est saturé d’une senteur étrange.",
        "Votre nez capte une effluve marquante.",
        "Un arôme de champignons pourris vous chatouille,",
        "Une effluve de sel marin envahit,",
        "Une odeur de soufre ancien s'élève,",
        "Un parfum de champs d'herbes folles perce,",
        "Un relent de poussière cimenteuse plane,"
      ],
      ouie: [
        "Un son singulier vous parvient à l’oreille.",
        "Vous percevez un bruit difficile à localiser.",
        "Un écho discret se répercute contre les murs.",
        "Le silence est trahi par un son inattendu.",
        "Une ambiance sonore se fait sentir dans le lointain.",
        "Un gémissement sourd perce le silence,",
        "Un murmure aigu semble vous appeler,",
        "Un tic-tac régulier résonne en écho,",
        "Un cliquetis lointain évoque un mécanisme,",
        "Une plainte lointaine se fait entendre,"
      ],
      toucher: [
        "En frôlant une paroi,",
        "Votre main effleure quelque chose d’inhabituel.",
        "Vous sentez sous vos doigts une texture particulière.",
        "Votre contact avec les lieux vous renseigne davantage.",
        "En glissant votre paume sur les murs,",
        "La surface paraît vibrer sous votre paume,",
        "Votre peau perçoit un léger picotement,",
        "Le sol semble pulser légèrement,",
        "Une fraîcheur soudaine glace vos doigts,",
        "Un courant d'air glacial frôle votre cuir,"
      ],
      gout: [
        "Une étrange saveur s’impose à votre bouche.",
        "Un arrière-goût persistant vous surprend.",
        "Votre palais est troublé par une sensation étrange.",
        "Un goût involontaire envahit votre bouche.",
        "Vous percevez en inspirant une saveur inattendue.",
        "Un arrière-goût de fer brûlé persiste,",
        "Votre langue perçoit une saveur sucrée étrange,",
        "Une pointe d'acidité pique votre palais,",
        "Un goût de sel ancien envahit votre bouche,",
        "Une note métallique intense résonne,"
      ]
    };

    function choix(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function genererGalerie() {
      const narration = [];
      narration.push(`<p>${choix(transitions.directions)} ${choix(directions)}</p>`);
      narration.push(`<p>${choix(transitions.environnement)} ${choix(environnement)}</p>`);
      const senses = Object.keys(sensesData);
      senses.sort(() => Math.random() - 0.5).slice(0,3).forEach(sens => {
        narration.push(`<p>${choix(transitions[sens])} ${choix(sensesData[sens])}</p>`);
      });
      const lootHtml = `<div class="loot">🎒 Vous trouvez : <strong>${choix(loot)}</strong></div>`;
      const intersectionHtml = `<div class="intersection">🔀 Intersection : ${choix(intersections)}</div>`;
      return `<div class="narration">${narration.join('')}</div><div class="extras">${lootHtml}${intersectionHtml}</div>`;
    }
    async function ameliorerTexteAvecIA(html) {
      try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST', headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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'
          }, body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              { role: 'system', content: "Retravaille ce HTML pour améliorer fluidité et style dans le contexte de 'Notre tombeau', en conservant les balises <p> et <div class='extras'>." },
              { role: 'user', content: html }
            ], temperature: 0.7
          })
        });
        if (!res.ok) {
          const err = await res.json();
          console.error('API error:', err.error?.message || err);
          return html;
        }
        const data = await res.json();
        return data.choices?.[0]?.message?.content || html;
      } catch (e) {
        console.error('Erreur réseau:', e);
        return html;
      }
    }
    async function genererEtAfficher() {
      const rawHtml = genererGalerie();
      document.getElementById('resultat').innerHTML = '<p>Amélioration en cours…</p>';
      const improved = await ameliorerTexteAvecIA(rawHtml);
      document.getElementById('resultat').innerHTML = improved;
    }
    document.getElementById('generate-btn').addEventListener('click', genererEtAfficher);
  </script>
</body>
</html>
